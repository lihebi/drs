#ifndef CHRONOAPP_H_
#define CHRONOAPP_H_

#include "ns3/ndn-app.h"
#include <boost/tuple/tuple.hpp>
#include "digest-log.h"

namespace ns3 {

class ChronoApp : public ndn::App
{
public:
	static TypeId GetTypeId();
	void StartApplication();
	void StopApplication();
	void OnInterest(Ptr<const ndn::Interest> interest);
	void OnData(Ptr<const ndn::Data> contentObject);
private:
	void ConfigFib();

	int GetNameType(std::string name);

	void ProcessSyncInterest(Ptr<ndn::Interest> &interest);
	void ProcessRecoveryInterest(Ptr<ndn::Interest> &interest);
	void ProcessDataInterest(Ptr<ndn::Interest> &interest);

	void ProcessSyncData(Ptr<ndn::Data> &contentObject);
	void ProcessRecoveryData(Ptr<ndn::Data> &contentObject);
	void ProcessDataData(Ptr<ndn::Data> &&&&&&&&contentObject);




	void ProcessRecoveryDigest(Ptr<const ndn::Interest> interest, std::string digest);
	bool ProcessDigest(Ptr<const ndn::Interest> interest, std::string digest);
	void ProcessAllPendingInterests();
	void DelayAndRecovery(Ptr<const ndn::Interest> &interest, std::string digest);
	void SendData(std::string name, const std::string msg);
	void ProcessRecoveryData(Ptr<const ndn::Data> contentObject);
	void ProcessSyncData(Ptr<const ndn::Data> contentObject);

	ChronoMessage m_messages;
	DigestTree m_digest_tree;
	DigestLog m_digest_log;
	std::string m_name;
	int m_seq;
	Ptr<ndn::Interest> m_pending_interest;
	std::vector<Ptr<ndn::Interest> > m_pending_recovery_interest;
};

} //ns3
#endif
